
<div   class="support article"><h2>Конфигурирование пуш-сервиса</h2><p>На мобильных платформах iOS и Android 8 , операционная система для экономии заряда батареи и памяти может останавливать приложения, полностью отключая их от сети. Чтоб приложение могло реагировать на звонки и сообщения, используется т.н. пуш-технология. Сервер Сибрус, отправляя сообщение клиентскому приложению, запущенному на мобильной платформе, через свой сервис pushd передает специальное пуш-сообщение соответственно через серверы Apple или Google мобильному клиенту. Сообщение не содержит никакой секретной информации и используется только для активации мобильного приложения. Запустившись, мобильное приложение обычным образом принимает сообщение или входящий звонок.</p><p>Для использования push-нотификаций необходимо:</p><ol><li><span>Получить у поставщика сервера СИБРУС сертификат шлюза, а так же сертификат и ключ клиента.</span></li><li><span>Включить поддержку push-нотификаций на сервере СИБРУС. </span></li><li><span>Сконфигурировать и запустить сервис пушей</span></li></ol><h3>Включение поддержки push-нотификаций на сервере СИБРУС. </h3><p>Для этого в файле конфигурации сервера СИБРУС /etc/cybrus/server.config необходимо указать опцию</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">push-notifications-enabled = true</div></div></div><h3>Конфигурирование сервиса пушей</h3><p>Распакуйте в папку c:\cybrus\server\config\ полученный в архиве файлы ca.crt, clientXX.key и clientXX.crt. Они одинаковые и для iOS и Android шлюза. Отредактируйте файл c:\cybrus\server\config\pushd.config , указав правильные имена файлов сертификатов и ключей в параметрах</p><pre>Для шлюза iOS:</pre><pre>apple-ca = 
apple-client-cert =<br/>apple-client-key = </pre><p>для шлюза Android:</p><pre>fcm-ca = <br/>fcm-client-cert = <br/>fcm-client-key = </pre><p>остальные параметры без необходимости изменять не надо</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="comment line">##############################################</div><div class="comment line"># Sample configuration file of cybrus pushd #</div><div class="comment line">##############################################</div><div class="comment line"># Name of database in MongoDB</div><div class="line">database = cybrus_server</div><div class="comment line"># IP address of MongoDB server</div><div class="line">mongo-address = 127.0.0.1</div><div class="comment line"># TCP port of MongoDB server</div><div class="line">mongo-port = 27017</div><div class="comment line"># IP address of Redis server</div><div class="line">redis-address = 127.0.0.1</div><div class="comment line"># TCP port of Redis server</div><div class="line">redis-port = 6379</div><div class="comment line"># Apple push notifications via cybrus-gateway-apple</div><div class="comment line">#</div><div class="comment line"># Enable Apple's push notifications</div><div class="line">apple-enabled = true</div><div class="line">fcm-enabled = true</div><div class="comment line"># HTTP or HTTPS?</div><div class="line">apple-https = true</div><div class="line">fcm-https = true</div><div class="comment line"># IP address of the gateway server</div><div class="line">apple-server-addr = push-gateway.cybrus.ru</div><div class="line">fcm-server-addr = push-gateway.cybrus.ru</div><div class="comment line"># TCP port of the gateway server</div><div class="line">apple-server-port = 2443</div><div class="line">fcm-server-port = 3443</div><div class="comment line"># Verify peer's SSL certificate</div><div class="line">apple-verify-peer = true</div><div class="line">fcm-verify-peer = true</div><div class="comment line"># The gateway's CA</div><div class="line">apple-ca = c:\cybrus\server\config\ca.crt</div><div class="line">fcm-ca = c:\cybrus\server\config\ca.crt</div><div class="comment line"># SSL certificate which is passed to the gateway</div><div class="line">apple-client-cert = c:\cybrus\server\config\client01.crt</div><div class="line">fcm-client-cert = c:\cybrus\server\config\client01.crt</div><div class="comment line"># The key for apple-client-cert</div><div class="line">apple-client-key = c:\cybrus\server\config\client01.key</div><div class="line">fcm-client-key = c:\cybrus\server\config\client01.key</div><div class="comment line"># The apple-client-key's passphrase</div><div class="line">apple-client-key-passphrase =</div><div class="line">fcm-client-key-passphrase =</div><div class="comment line"># How long to wait for the gateway's response</div><div class="line">apple-timeout-ms = 20000</div><div class="line">fcm-timeout-ms = 20000</div><div class="comment line"># Should we throttle notifications with the same token?</div><div class="line">apple-delay-enabled = true</div><div class="comment line">#fcm-delay-enabled = true</div><div class="line">apple-delay-ms = 1500</div><div class="comment line">#fcm-delay-ms = 1500</div><div class="comment line"># Enable logging for every notification</div><div class="comment line"># Do not enable for production</div><div class="line">log-enabled = true</div><div class="line">verbose_level = 9</div><div class="line">fatal_log_file=c:\cybrus\pushd-fatal.log</div><div class="line">log_file=c:\cybrus\pushd.log</div></div></div><p>Настройте запуск службы пушей как сервиса Windows</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">c:\cybrus\server\bin\nssm install CybrusPushD c:\cybrus\server\bin\cybrus-pushd.exe "--config c:\cybrus\server\config\pushd.config"</div><div class="line">c:\cybrus\server\bin\nssm set CybrusPushD DependOnService MongoDB redis</div><div class="line"> </div><div class="line">c:\cybrus\server\bin\nssm set CybrusPushD AppStdout "c:\cybrus\pushd-stdout.log"</div><div class="line">c:\cybrus\server\bin\nssm set CybrusPushD AppStderr "c:\cybrus\pushd-stderr.log"</div><div class="line">c:\cybrus\server\bin\nssm set CybrusPushD Description "Cybrus PushD"</div></div></div><p>Запустите службу пушей как сервис Windows</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">net start CybrusPushD </div></div></div><p class="auto-cursor-target"><br/></p></div>
