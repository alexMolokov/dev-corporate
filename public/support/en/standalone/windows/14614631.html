
<div   class="support article"><h3 class="auto-cursor-target">Windows server</h3><p>1. Остановите сервисы Сибрус</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">net stop CybrusConfig</div><div class="line">net stop CybrusRelay</div><div class="line">net stop CybrusServer</div></div></div><p>2. Обязательно сделайте резервную копию базы данных</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">c:\cybrus\mongo\mongodump --host 127.0.0.1 --port 27017 --db cybrus_server --out c:\cybrus\mongo\backup01\</div></div></div><p>бекап запишется в текущую папку в c:\cybrus\mongo\backup01\</p><p>3. Обновите сервер Сибрус, перезаписав содержимое папок c:\cybrus\server\bin\ и c:\cybrus\server\locale соответствующим содержимым архива с новым дистрибутивом</p><p>4. Обновите базу и индексы базы данных</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">c:\cybrus\server\bin\cybrus-database-adm.exe --dbname cybrus_server --domain cybrus.sample --mongo-uri 127.0.0.1:27017 -o database-upgrade</div><div class="line">c:\cybrus\server\bin\cybrus-database-adm.exe --dbname cybrus_server --domain cybrus.sample --mongo-uri 127.0.0.1:27017 --drop-indexes -o indexes-create </div></div></div><p>5. Запустите сервисы Сибрус</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">net start CybrusServer</div><div class="line">net start CybrusRelay</div><div class="line">net start CybrusConfig</div></div></div><h4>Если при выполнении п.4 происходит ошибка при удалении индексов:</h4><div class="alert alert-noformat"><div class="codeContent panelContent pdl"><div class="line">c:\&gt;c:\cybrus\server\bin\cybrus-database-adm --dbname cybrus_server --domain cybrus.sample --mongo-uri 127.0.0.1:27017 --drop-indexes -o indexes-create</div><div class="line">исключение mogno: 10007 dropIndex failed</div><div class="line">terminate called after throwing an instance of 'mongo::DBException'</div><div class="line">what(): dropIndex failed</div><div class="line">Аварийный останов</div><div class="line">c:\&gt;</div></div></div><p>нужно подключиться консолью монги к базе данных и выполнить удаление индексов вручную </p><div class="alert alert-noformat"><div class="codeContent panelContent pdl"><div class="line">c:\&gt;c:\cybrus\mongo\bin\mongo cybrus_server</div><div class="line">&gt; db.getCollectionNames().forEach(function (d) { db[d].dropIndexes(); });</div><div class="line">&gt; quit</div><div class="line">c:\&gt;</div></div></div><p class="auto-cursor-target"><br/></p></div>
