
<div   class="support article"><p>Сервер автоконфигурации используется для автоматической настройки клиента на работу именно с вашим сервером Сибрус. Все передаваемые клиенту параметры описаны в файле client_autoconf.config </p><div class="alert alert-note"><div class="rich-text">Использование Сервера Автоконфигурации не является обязательным и его настройку и запуск можно пропустить.</div></div><p>При первом запуске вы должны сообщить клиентскому приложению адрес вашего сервера Сибрус:</p><ol><li><span>Указав явно в настройках клиентского приложения. "Параметры" "Хост" . При этом сервер автоконфигурации не требуется.</span></li><li><span>Загрузив конфигурацию клиента, содержащую в том числе адрес сервера Сибрус, используя сервер автоконфигурации <br/>А. Вручную, выбрав "Параметры" "Хост" "Загрузить параметры с сервера" при первоначальном запуске клиента и явно указав IP-адрес и порт сервера автоконфигурации.<br/>Б. Воспользоваться сервисом domains.cybrus.ru  Для этого Вы должны сообщить нам внешний IP-адрес или DNS-имя своего сервера и название домена Сибрус. Тогда клиентское приложение сможет при первом запуске по логину вида имя_пользователя@имя_домена через наш сервис найти IP-адрес вашего сервера Сибрус<br/>В. Если домен Сибрус совпадает с доменом службы DNS , вы можете создать SRV запись на сервере DNS по которой клиентское приложение будет находить IP-адрес сервера Сибрус. <br/>Для домена cybrus.example и сервера srv.cybrus.example SRV запись будет выглядеть следующим образом<br/>_cybrusc._tcp.cybrus.example    SRV   0 0 37212 srv.cybrus.example.<br/>Г. Загрузив при первоначальном запуске клиента параметры из файла .dfs (этот файл формируется администратором и позволяет конфигурировать клиента не используя сервис автоконфигурации)</span></li></ol><h3>Настройка Сервера Автоконфигурации.</h3><h4>1. Получите ключ и сертификат</h4><p>Параметры, передаваемые клиенту с сервера автоконфигурации, шифруются. Вы должны использовать сертификат, подписанный разработчиками Сибрус или вашем доверенным центром сертификации как описано в разделе "Генерация ключей и получение сертификата сервера Сибрус". Для сервера автоконфигурации не допускается использовать самоподписанный сертификат.</p><h4>2. Настройте Сервер Автоконфигурации</h4><p>Скопируйте содержимое файла c:\cybrus\server\config\server.config.sample в c:\cybrus\server\config\server-auto.config .</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">copy c:\cybrus\server\config\server-auto.config.sample c:\cybrus\server\config\server-auto.config</div></div></div><p>Отредактируйте файл server-auto.config, указав следующие параметры</p><table class="relative-table"><colgroup><col/><col/></colgroup><tbody><tr><th colspan="2">Обязательные параметры</th></tr><tr><td><pre class="config">private-key-file = c:\cybrus\server\config\cybrus.key</pre></td><td><span>Путь к приватному ключу сервера</span><span>, полученному в разделе "Генерация ключей и получение сертификата сервера"</span></td></tr><tr><td><pre class="config">private-key-file-passphrase = secret_passphrase</pre></td><td><span>Парольная фраза приватного ключа</span><span>, полученная в разделе "Генерация ключей и получение сертификата сервера"</span></td></tr><tr><td><pre class="config">certificate-chain-file = <br/>c:\cybrus\server\config\cybrus_certificate.pem</pre></td><td><span>Путь к сертификату сервера</span><span>, полученному в разделе "Генерация ключей и получение сертификата сервера"</span></td></tr><tr><td><pre>domain = cybrus.example</pre></td><td><span>Домен вашего сервера Сибрус</span><span>, который вы указывали при инициализации базы данных</span></td></tr><tr><td><pre class="config">listen-address = 0.0.0.0</pre></td><td>IP-адрес Сервера Автоконфигурации. Здесь необходимо указать IP адрес, на котором Сервер Автоконфигурации будет принимать подключения. Адрес 0.0.0.0 означает  все интерфейсы . Можно так же указать конкретный IP-адрес внешнего интерфейса сервера Windows.</td></tr><tr><td><pre class="config">listen-port = 37212</pre></td><td>Номер порта Сервера Автоконфигурации</td></tr><tr><td><pre class="config">mongo-address = 127.0.0.1</pre></td><td>IP адрес MongoDB сервера</td></tr><tr><td><pre class="config">mongo-port = 27017</pre></td><td>TCP порт MongoDB сервера</td></tr><tr><td colspan="1"><pre class="config">dbname = cybrus_server</pre></td><td colspan="1">Имя базы данных</td></tr></tbody></table><h4>3. Отредактируйте файл автоконфигурации клиента</h4><p>В этом файле описываются параметры, которые передаются клиенту сервером автоконфигурации.</p><p>Скопируйте содержимое файла</p><p>c:\cybrus\server\config\client_autoconf.config.sample в c:\cybrus\server\config\client_autoconf.config</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">copy c:\cybrus\server\config\client_autoconf.config.sample c:\cybrus\server\config\client_autoconf.config</div></div></div><p>Отредактируйте файл client_autoconf.config, указав следующие параметры:</p><table class="relative-table"><colgroup><col/><col/></colgroup><tbody><tr><th><br/></th><th><br/></th></tr><tr><td>autoconf-use-access-code=0</td><td>Необходимость ввода код доступа при автоконфигурации</td></tr><tr><td>autoconf-access-code=</td><td>код доступа, если он используется</td></tr><tr><td>cybrus-server-certificate-file= c:\cybrus\server\config\cybrus_certificate.pem</td><td>файл сертификата cервера Сибрус</td></tr><tr><td>cybrus-server-host=10.10.1.180</td><td>Укажите доменное имя или IP-адрес вашего Сервера (IP адрес должен совпадать со значением параметра external-listen-address, установленным в п.7)</td></tr><tr><td>cybrus-server-port=37210</td><td>Номер порта Сервера</td></tr><tr><td>sip-enable=0</td><td>Использование SIP сервера</td></tr><tr><td>sip-strict-phone-number=1</td><td>Если используются номера в стандарте E.123 (Номер должен начинаться с + , затем код страны и номер телефона, например, +123456789), установите параметр  1. Если допускаются любые номера, например, SIP  сервер это ваша местная станция, установите параметр в 0. При этом допускаются любые номера. Например, 106).</td></tr></tbody></table><p><br/></p><h4>4. Сохраните настройки автоконфигурации в базе данных</h4><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">c:\cybrus\server\bin\cybrusadm --operation save_clients_autoconf --clients-autoconf-file c:\cybrus\server\config\client_autoconf.config --domain cybrus.example --dbname cybrus_server</div></div></div><p>На запрос  Enter passphrase to decrypt private key  введите пароль из п.1</p><p>Если вам потребуется сменить настройки автоконфигурации, отредактируйте  файл client_autoconf.config и опять выполните cybrusadm  с операцией save_clients_autoconf. После сохранения параметров автоконфигурации необходимо перезапустить только Сервер Автоконфигурации.</p><h4>5. Запустите Сервер Автоконфигурации как консольное приложение:</h4><p>Сначала выполните команду, чтобы убедиться, что в файле конфигурации нет ошибок:</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">c:\cybrus\server\bin\cybrus-server --autoconf --config c:\cybrus\server\config\server-auto.config</div></div></div><p>Если не появилось приглашение командной строки, значит, сервер успешно стартовал. Прервите его работу, нажав CTRL+C.</p><p>Затем запустите его в отдельном окне командой:</p><div class="code panel pdl"><div class="codeContent panelContent pdl"><div class="line">start c:\cybrus\server\bin\cybrus-server --autoconf --config c:\cybrus\server\config\server-auto.config</div></div></div><p class="auto-cursor-target">После окончания настройки всех сервисов Сибрус, рекомендуется настроить их запуск как сервисов Windows. См. раздел "Настройка запуска сервера Сибрус как сервиса Windows"</p></div>
